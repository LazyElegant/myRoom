<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bobo.test.mapper.IkonMapper">
	
    <insert id="insertIkon">
		insert into `ikon`
		values(#{id},#{classifyId},#{title},#{pic},#{authorId},#{context},#{issueTime});
	</insert>
	
	<select id="listIkon" resultType="com.bobo.test.vo.ListIkonVo">
		SELECT i.id,
			 i.title,
			 i.pic,
			 u.`name` `author`
		FROM ikon i
		LEFT JOIN `user` u ON u.id = i.author_id
	</select>
	<select id="listIkonByCollect" resultType="com.bobo.test.vo.ListIkonVo">
		SELECT i.id,
			 i.title,
			 i.pic,
			 u.`name` `author`
		FROM ikon i
		LEFT JOIN `user` u ON u.id = i.author_id
		LEFT JOIN collect col ON i.id = col.ikon_id
		where col.user_id = #{id}
	</select>
	<select id="listIkonByClassify" resultType="com.bobo.test.vo.ListIkonVo">
		SELECT i.id,
			 i.title,
			 i.pic,
			 u.`name` `author`
		FROM ikon i
		LEFT JOIN `user` u ON u.id = i.author_id
		LEFT JOIN classify c ON c.id = i.classify_id
		where c.id = #{id}
	</select>
	<select id="listIkonByConcern" resultType="com.bobo.test.vo.ListIkonVo">
		SELECT i.id,
			 i.title,
			 i.pic,
			 u.`name` `author`
		FROM ikon i
		LEFT JOIN `user` u ON u.id = i.author_id
		LEFT JOIN `concern` c on c.concern_id = i.author_id
		where c.user_id = #{id}
	</select>
	<select id="likeIkon" resultType="com.bobo.test.vo.ListIkonVo">
		SELECT i.id,
			 i.title,
			 i.pic,
			 u.`name` `author`
		FROM ikon i
		LEFT JOIN `user` u ON u.id = i.author_id
		where  i.title like CONCAT('%' ,#{title} ,'%')
	</select>
	<select id="getIkon" resultType="com.bobo.test.vo.IkonVo">
		SELECT i.id,
			 u.id `authorId`,
			 u.`name` `author`,
			 i.title,
			 i.pic,
			 i.context,
			 i.issue_time `issueTime`,
			 c.`name` `classify`
		FROM ikon i
		LEFT JOIN `user` u ON u.id = i.author_id
		LEFT JOIN classify c ON c.id = i.classify_id
		WHERE i.id = #{id}
	</select>

	<select id="listIkonByAuthor" resultType="com.bobo.test.vo.ListIkonByAuthorVo">
		SELECT i.id,
			i.title,
			i.issue_time 'issueTime',
			i.pic,
			i.context,
			cla.`name` 'classify',
			COUNT(DISTINCT col.id) 'collect',
			COUNT(DISTINCT t.id) 'thumb'
		FROM ikon i
			LEFT JOIN classify cla ON cla.id = i.classify_id
			LEFT JOIN thumb t ON i.id = t.Ikon_id
			LEFT JOIN collect col ON i.id = col.ikon_id
		WHERE i.author_id = #{authorId}
		GROUP BY i.id
	</select>
	<select id="listIkonVo" resultType="com.bobo.test.vo.IkonVOByAdmin">
		SELECT i.id,
			i.title,
			i.issue_time 'issueTime',
			u.name 'author',
			i.pic,
			i.context,
			cla.`name` 'classify',
			COUNT(DISTINCT col.id) 'collect',
			COUNT(DISTINCT t.id) 'thumb'
		FROM ikon i
			LEFT JOIN classify cla ON cla.id = i.classify_id
			LEFT JOIN `user` u ON u.id = i.author_id
			LEFT JOIN thumb t ON i.id = t.Ikon_id
			LEFT JOIN collect col ON i.id = col.ikon_id
		GROUP BY i.id
	</select>
	<delete id="deleteIkon">
		DELETE FROM `ikon`
		WHERE id = #{id}
	</delete>
</mapper>